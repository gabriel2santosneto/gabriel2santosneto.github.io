@media (min-width: 1040px) {
  .content-shell {
    flex-direction: row;
    align-items: flex-start;
    gap: 0;
  }
  .profile-pane {
    width: 340px;
    min-width: 280px;
    max-width: 360px;
    border-right: 1px solid #d8d3ca;
    background: #fff;
    box-shadow: 2px 0 8px rgba(0,0,0,0.04);
    height: 100%;
    align-items: flex-start;
    text-align: left;
    padding: 40px 0 8px 0;
    margin: 0;
    position: relative;
  }
  .profile-pane .profile-photo {
    margin: 0 auto 12px auto;
    display: block;
  }
  .main-area {
    flex: 1;
    padding: 32px 40px;
    min-width: 0;
    background: #f8fafc;
    height: 100%;
  }
}
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
    <title>Portfolio Explorer</title>
    <link href="../../lib/os-gui/layout.css" rel="stylesheet" type="text/css" />
    <link
      href="../../lib/os-gui/windows-98.css"
      rel="stylesheet"
      type="text/css"
    />
    <link href="../../classic.css" rel="stylesheet" type="text/css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Pixelify+Sans:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        font-family: "MS Sans Serif", "Segoe UI", sans-serif;
        color: #111;
        --chrome-offset: 0px;
      }
      html,
      body {
        overscroll-behavior: none;
        touch-action: pan-y;
        width: 100%;
        max-width: 100%;
        overflow-x: hidden;
        position: fixed;
        height: 100%;
      }
      body {
        margin: 0;
        padding: 0;
        background-color: #006b7b;
        background-image: linear-gradient(
          135deg,
          #006b7b 0%,
          #005266 45%,
          #004152 100%
        );
        overflow: hidden;
        font-size: 18px;
        -webkit-overflow-scrolling: touch;
      }
      .browser {
        background-color: #dcd7cf;
        border: none;
        margin: 0;
        width: 100%;
        max-width: 100%;
        min-height: 100vh;
        max-height: 100vh;
        display: flex;
        flex-direction: column;
        box-shadow: none;
        box-sizing: border-box;
        overflow-y: auto;
      }
      .titlebar {
        background: linear-gradient(
          90deg,
          #00205c 0%,
          #0045a1 60%,
          #00a1ff 100%
        );
        color: #fff;
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 6px 14px; /* ~50% taller */
        font-weight: 600;
        font-size: 18px; /* scale label size with height */
        font-family: "Pixelify Sans", "MS Sans Serif", sans-serif;
      }
      .window-controls {
        display: flex;
        gap: 4px;
      }
      .window-controls span {
        display: inline-block;
        width: 18px;
        height: 16px;
        border: 1px solid rgba(255, 255, 255, 0.45);
        text-align: center;
        line-height: 14px;
        background-color: rgba(0, 0, 0, 0.2);
        font-weight: normal;
      }
      .browser-chrome {
        position: sticky;
        top: 0;
        z-index: 5;
        background-color: #f0eee6;
        box-shadow: 0 4px 0 rgba(0, 0, 0, 0.08);
      }
      .menu-strip {
        display: flex;
        gap: 18px;
        padding: 4px 14px;
        font-size: 12px;
        background-color: #f0eee6;
        border-top: 1px solid #ffffff;
        border-bottom: 1px solid #8c8b8b;
      }
      .toolbar {
        display: flex;
        gap: 12px;
        padding: 8px 14px;
        border-bottom: 1px solid #8c8b8b;
        background: linear-gradient(
          180deg,
          #f6f3ed 0%,
          #d5d0c6 70%,
          #c1bbb1 100%
        );
        box-shadow: inset 0 1px 0 #fff;
      }
      .tool-button {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 4px;
        font-size: 11px;
        width: 64px;
        color: #111;
        cursor: pointer;
        user-select: none;
      }
      .tool-button img {
        width: 24px;
        height: 24px;
        image-rendering: pixelated;
      }
      .address-bar {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 6px 12px;
        border-bottom: 1px solid #8c8b8b;
        background-color: #ede7de;
        font-size: 12px;
      }
      .address-bar input {
        flex: 1;
        border: 2px inset #fff;
        padding: 2px 6px;
        font-size: 12px;
        background-color: #f9f9f9;
      }
      .content-shell {
        display: flex;
        flex: 1;
        min-height: 0;
        align-items: stretch;
        gap: 0;
        background-color: #f8fafc;
        flex-direction: column;
      }
      .profile-pane {
        width: 100%;
        background-color: #fff;
        border: none;
        padding: 40px 16px 8px;
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
        gap: 12px;
        box-shadow: none;
        position: relative;
        top: auto;
        max-height: none;
        height: auto;
        overflow: visible;
        margin: 0 auto 0;
      }
      .profile-pane .nav-list {
        width: min(360px, 100%);
        margin: 24px auto 8px;
        padding: 20px;
        border: 1px solid #444;
        background: #fff;
      }
      .profile-pane .nav-list li { justify-content: flex-start; }
      .profile-pane .profile-name { margin-top: 4px; }
      .profile-pane .profile-tagline { margin-bottom: 4px; }
      .main-area { margin-top: 24px; }
      .profile-photo {
        width: 120px;
        height: 120px;
        border-radius: 50%;
        object-fit: cover;
        border: 3px solid #fff;
        margin: 0 auto;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.35);
      }
      .profile-name {
        text-align: center;
        font-weight: bold;
        font-size: 22px;
      }
      .profile-tagline {
        text-align: center;
        font-size: 16px;
        color: #2d4c3c;
      }
      .nav-list {
        list-style: none;
        padding: 20px;
        margin: 12px 20px 0 0;
        display: flex;
        flex-direction: column;
        gap: 8px;
        color: #004c99;
        border: 1px solid #000;
        background-color: #ffffff;
        box-shadow: inset 1px 1px 0 #fff;
      }
      .nav-list li {
        display: flex;
        align-items: center;
        gap: 6px;
      }
      .nav-list li::before {
        content: "•";
        color: #0c56c3;
        font-size: 16px;
        line-height: 1;
      }
      .nav-list button {
        flex: 1;
        background: none;
        border: none;
        padding: 0;
        text-align: left;
        font-size: 18px;
        color: #004c99;
        cursor: pointer;
      }
      .nav-list li.active button {
        font-weight: bold;
        text-decoration: underline;
        color: #00255c;
      }
      .nav-list button:focus-visible {
        outline: none;
      }
      .nav-list li:focus-within {
        outline: none;
      }
      .main-area {
        flex: 1;
        background-color: #f8fafc;
        padding: 28px 32px;
        overflow: visible;
        min-height: 0;
      }
      .section {
        margin-bottom: 32px;
        padding: 20px;
        border: 1px solid #d8d3ca;
        background-color: #ffffff;
        box-shadow: inset 0 0 0 1px #fff, 0 3px 0 #c4bfb4;
        font-size: 18px;
      }
      .section-about {
        background-color: rgb(245, 255, 250);
      }
      .about-header {
        background-color: rgb(206, 242, 224);
        padding: 12px 16px;
        margin: -20px -20px 16px;
        border-bottom: 1px solid #a9d8c2;
      }
      .section-projects {
        background-color: #f5faff;
        border-color: #cedff2;
      }
      .projects-header {
        background-color: #cedff2;
        padding: 12px 16px;
        margin: -20px -20px 16px;
        border-bottom: 1px solid #a3c5e2;
      }
      .section-testimonials {
        background-color: #faf5ff;
        border-color: #ddcef2;
      }
      .testimonials-header {
        background-color: #afa3bf;
        padding: 12px 16px;
        margin: -20px -20px 16px;
        border-bottom: 1px solid #8e7ba5;
      }
      .section-socials {
        background-color: rgb(245, 255, 250);
        border-color: #b9e6d1;
      }
      .socials-header {
        background-color: rgb(206, 242, 224);
        padding: 12px 16px;
        margin: -20px -20px 16px;
        border-bottom: 1px solid #a9d8c2;
      }
      .section-services {
        background-color: #f5faff;
        border-color: #cedff2;
      }
      .services-header {
        background-color: #cedff2;
        padding: 12px 16px;
        margin: -20px -20px 16px;
        border-bottom: 1px solid #a3c5e2;
      }
      .section-contact {
        background-color: #f5faff;
        border-color: #cedff2;
      }
      .contact-header {
        background-color: #cedff2;
        padding: 12px 16px;
        margin: -20px -20px 16px;
        border-bottom: 1px solid #a3c5e2;
      }
      .section-faq {
        background-color: #faf5ff;
        border-color: #ddcef2;
      }
      .faq-header {
        background-color: #afa3bf;
        padding: 12px 16px;
        margin: -20px -20px 16px;
        border-bottom: 1px solid #8e7ba5;
      }
      .section-framework {
        background-color: #fff9f1;
        border-color: #f2d7b7;
      }
      .framework-header {
        background-color: #f2d7b7;
        padding: 12px 16px;
        margin: -20px -20px 16px;
        border-bottom: 1px solid #d9b68d;
      }
      .framework-steps {
        list-style: decimal;
        margin: 0;
        padding-left: 20px;
        display: flex;
        flex-direction: column;
        gap: 8px;
      }
      .framework-steps li strong {
        color: #7a3e00;
      }
      .section h2 {
        margin: 0;
        font-size: 26px;
      }
      .section p {
        margin-bottom: 0;
        line-height: 1.7;
      }
      .hero-title {
        font-size: 34px;
        margin: 0 0 8px;
      }
      .hero-banner {
        display: flex;
        flex-direction: column;
        gap: 10px;
        align-items: center;
        text-align: center;
        padding: 24px;
        border-radius: 6px;
      }
      .availability {
        color: #0d8146;
        font-weight: bold;
        font-size: 16px;
        padding: 4px 10px;
        border-radius: 999px;
      }
      .hero-title {
        color: #1f3470;
      }
      .projects-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 18px;
        margin-top: 16px;
        font-size: 18px;
      }
      .project-card {
        background-color: #f7f7f7;
        border: 1px solid #b6b3ad;
        padding: 12px;
        display: flex;
        flex-direction: column;
        gap: 10px;
      }
      .project-card img {
        width: 100%;
        height: 140px;
        object-fit: cover;
        border: 2px solid #fff;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.15);
      }
      .pill-list {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        margin-top: 12px;
      }
      .pill {
        background-color: #e0ecff;
        color: #1c4e8a;
        font-size: 14px;
        padding: 4px 10px;
        border-radius: 999px;
      }
      .faq-item {
        margin-bottom: 12px;
      }
      .faq-item strong {
        display: block;
        margin-bottom: 4px;
      }
      @media (max-width: 1040px) {
        .profile-pane {
          position: relative;
          top: auto;
          align-self: auto;
          max-height: none;
        }
      }
      @media (max-width: 900px) {
        .content-shell {
          flex-direction: column;
        }
        .main-area {
          padding: 20px;
        }
      }
      @media (max-width: 520px) {
        body {
          background-color: #004152;
          padding: 0;
        }
        .browser {
          max-width: 100%;
          min-height: 100vh;
          max-height: 100vh;
          border: none;
          box-shadow: none;
          border-radius: 0;
          margin: 0 auto;
          width: 100%;
          overflow-y: auto;
        }
        .browser-chrome {
          position: sticky;
          top: 0;
          z-index: 10;
        }
        .toolbar {
          flex-wrap: wrap;
          justify-content: center;
          gap: 8px;
          padding: 6px 8px;
        }
        .tool-button {
          width: 56px;
          font-size: 10px;
        }
        .tool-button img {
          width: 28px;
          height: 28px;
        }
        .menu-strip {
          gap: 12px;
          padding: 4px 10px;
          font-size: 11px;
          overflow-x: auto;
          -webkit-overflow-scrolling: touch;
        }
        .address-bar {
          flex-direction: column;
          align-items: stretch;
          padding: 4px 8px;
        }
        .profile-pane .profile-photo {
          width: 96px;
          height: 96px;
        }
        .profile-pane .nav-list {
          padding: 16px;
        }
        .main-area {
          padding: 16px 14px;
          overflow-y: visible;
        }
        .section {
          padding: 16px;
        }
        .projects-grid {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <div class="browser">
      <div class="browser-chrome">
        <div class="menu-strip">
          <span>File</span>
          <span>Edit</span>
          <span>View</span>
          <span>Go</span>
          <span>Favourites</span>
          <span>Help</span>
        </div>
        <div class="toolbar">
          <div class="tool-button" id="refresh-btn">
            <img
              src="../../images/refresh1.png"
              alt="Refresh"
            /><span>Refresh</span>
          </div>
          <div class="tool-button" id="home-btn">
            <img
              src="../../images/home1.png"
              alt="Home"
            /><span>Home</span>
          </div>
          <div class="tool-button" id="resume-btn">
            <img
              src="../../images/briefcase1.png"
              alt="Resume"
            /><span>Resume</span>
          </div>
            <div class="tool-button" id="framework-btn">
            <img
              src="../../images/framework2.png"
              alt="Framework"
            /><span>Framework</span>
          </div>
          <div class="tool-button" data-section-target="contact">
            <img src="../../images/mail1.png" alt="Send" /><span>Send</span>
          </div>
          <div class="tool-button" id="blog-btn">
            <img src="../../images/blog.png" alt="Blog" /><span>Blog</span>
          </div>
        </div>
      </div>
      <div class="content-shell">
        <aside class="profile-pane">
          <img
            class="profile-photo"
            src="../../images/lego_profile.png"
            alt="Gabriel"
          />
          <div class="profile-name">Gabriel dos Santos</div>
          <div class="profile-tagline">The Portfoliopedia</div>
          <ul class="nav-list">
            <li>
              <button class="nav-link active" data-section="hero">
                Welcome
              </button>
            </li>
            <li>
              <button class="nav-link" data-section="about">About me</button>
            </li>
            <li>
              <button class="nav-link" data-section="projects">
                Selected Projects
              </button>
            </li>
            <li>
              <button class="nav-link" data-section="testimonials">
                Client Testimonials
              </button>
            </li>
            <li>
              <button class="nav-link" data-section="socials">Socials</button>
            </li>
            <li>
              <button class="nav-link" data-section="services">Services</button>
            </li>
            <li>
              <button class="nav-link" data-section="framework">
                Framework
              </button>
            </li>
            <li><button class="nav-link" data-section="faq">FAQ</button></li>
            <li>
              <button class="nav-link" data-section="contact">Contact</button>
            </li>
          </ul>
        </aside>
        <main class="main-area">
          <section class="section" id="hero">
            <div class="hero-banner">
              <h1 class="hero-title">Welcome to my Portfolio,</h1>
              <p>
                the digital archive of my work, crafted in a retro-inspired web
                experience.
              </p>
              <span class="availability">● Available for work</span>
            </div>
          </section>
          <section class="section section-about" id="about">
            <div class="about-header">
              <h2>About me</h2>
            </div>
            <p>
              Welcome to my corner of the internet. I am a creative technologist
              with a passion for STEM education, robotics, and playful
              storytelling. Inspired by the aesthetics of the past, I craft
              digital spaces that feel both familiar and fresh.<br /><br />
              When I am not designing, you will find me prototyping new learning
              tools, teaching future inventors, or diving deep into emerging
              tech to turn curiosity into tangible experiences.
            </p>
          </section>
          <section class="section section-projects" id="projects">
            <div class="projects-header">
              <h2>Selected Projects</h2>
            </div>
            <div class="projects-grid">
              <div class="project-card">
                <img src="../../images/old-google.png" alt="Robotics Camp" />
                <strong>Robotics Playground</strong>
                <p>
                  Immersive robotics curriculum for 300+ students across LATAM.
                </p>
              </div>
              <div class="project-card">
                <img src="../../images/3d.jpg" alt="STEM Studio" />
                <strong>STEM Studio OS</strong>
                <p>
                  Browser-based OS that turns workshops into interactive
                  missions.
                </p>
              </div>
              <div class="project-card">
                <img src="../../images/clouds.jpg" alt="Design Lab" />
                <strong>Design Lab 98</strong>
                <p>
                  Retro-inspired design lab for teaching engineering
                  storytelling.
                </p>
              </div>
            </div>
          </section>
          <section class="section section-testimonials" id="testimonials">
            <div class="testimonials-header">
              <h2>Client Testimonials</h2>
            </div>
            <p>
              “Gabriel translates complex tech into engaging adventures.
              Students feel like they are stepping into a universe built just
              for them.” — Creative Learning Lead
            </p>
          </section>
          <section class="section section-socials" id="socials">
            <div class="socials-header">
              <h2>Socials & Signals</h2>
            </div>
            <div class="pill-list">
              <span class="pill">LinkedIn</span>
              <span class="pill">Instagram</span>
              <span class="pill">YouTube</span>
              <span class="pill">Medium</span>
            </div>
          </section>
          <section class="section section-services" id="services">
            <div class="services-header">
              <h2>Services</h2>
            </div>
            <ul>
              <li>STEM & Robotics Program Design</li>
              <li>Teacher Training & Facilitation</li>
              <li>Interactive Learning Installations</li>
              <li>Creative Tech Consulting</li>
            </ul>
          </section>
          <section class="section section-framework" id="framework">
            <div class="framework-header">
              <h2>Framework</h2>
            </div>
            <ol class="framework-steps">
              <li>
                <strong>Kickoff & Alignment</strong> — define success metrics,
                key audiences, and guardrails for the build.
              </li>
              <li>
                <strong>Discovery</strong> — collect context from students,
                educators, and partners to map current journeys.
              </li>
              <li>
                <strong>Prototype</strong> — translate insights into interactive
                concepts, visual worlds, and curriculum beats.
              </li>
              <li>
                <strong>Playtest</strong> — run hands-on demos, gather feedback,
                and stress test accessibility.
              </li>
              <li>
                <strong>Launch & Facilitate</strong> — ship the experience with
                toolkits, facilitator guides, and on-site support.
              </li>
              <li>
                <strong>Optimize</strong> — measure impact, tune the system, and
                plan the next chapter.
              </li>
            </ol>
          </section>
          <section class="section section-faq" id="faq">
            <div class="faq-header">
              <h2>FAQ</h2>
            </div>
            <div class="faq-item">
              <strong>What industries do you serve?</strong>
              <span
                >Schools, museums, ed-tech teams, and creative studios.</span
              >
            </div>
            <div class="faq-item">
              <strong>Where do you work?</strong>
              <span
                >Remote-first with on-site programs available across the US &
                LATAM.</span
              >
            </div>
          </section>
          <section class="section section-contact" id="contact">
            <div class="contact-header">
              <h2>Contact</h2>
            </div>
            <p>
              Email me directly at
              <a href="mailto:example@mail.com">example@mail.com</a> or drop a
              line through the desktop contact icon. Let’s build something
              unforgettable.
            </p>
          </section>
        </main>
      </div>
    </div>
    <script>
      const links = document.querySelectorAll(".nav-link");
      const sections = Array.from(document.querySelectorAll(".section"));
      const mainArea = document.querySelector(".main-area");
      const browserEl = document.querySelector(".browser");
      const docScrollElement =
        document.scrollingElement || document.documentElement || document.body;
      const chromeBar = document.querySelector(".browser-chrome");
      const defaultSection = links[0]?.dataset.section || "hero";
      if ("scrollRestoration" in history) {
        history.scrollRestoration = "manual";
      }

      const updateChromeOffset = () => {
        const chromeHeight = chromeBar?.offsetHeight || 0;
        document.documentElement.style.setProperty(
          "--chrome-offset",
          `${chromeHeight}px`
        );
      };
      updateChromeOffset();
      window.addEventListener("resize", updateChromeOffset);

      const areaScrollable = (el) =>
        !!el && el.scrollHeight > el.clientHeight + 1;

      const usesDocumentScroll = () =>
        !areaScrollable(mainArea) && !areaScrollable(browserEl);

      const getScrollElement = () => {
        if (areaScrollable(mainArea)) return mainArea;
        if (areaScrollable(browserEl)) return browserEl;
        return docScrollElement;
      };

      const getScrollTop = (el) => {
        if (!el) return 0;
        if (el === document.body || el === document.documentElement) {
          return (
            window.scrollY ||
            document.documentElement.scrollTop ||
            document.body.scrollTop ||
            0
          );
        }
        return el.scrollTop;
      };

      const scrollElementTo = (el, top, behavior) => {
        if (!el) return;
        if (el === document.body || el === document.documentElement) {
          window.scrollTo({ top, behavior });
        } else {
          el.scrollTo({ top, behavior });
        }
      };

      function setActiveLink(id) {
        links.forEach((btn) => {
          const isActive = btn.dataset.section === id;
          btn.classList.toggle("active", isActive);
          btn.parentElement?.classList.toggle("active", isActive);
        });
      }

      function scrollSection(
        id,
        { behavior = "smooth", updateHistory = true } = {}
      ) {
        if (!id) return;
        const target = document.getElementById(id);
        if (!target) return;
        const scrollElement = getScrollElement();
        if (!scrollElement) return;
        const documentScrolling = scrollElement !== mainArea;
        const chromeOffset = documentScrolling
          ? (chromeBar?.offsetHeight || 0) + 8
          : 0;
        const offset =
          target.getBoundingClientRect().top -
          (documentScrolling ? 0 : scrollElement.getBoundingClientRect().top) +
          getScrollTop(scrollElement) -
          chromeOffset;
        scrollElementTo(scrollElement, Math.max(offset, 0), behavior);
        setActiveLink(id);
        if (updateHistory) {
          history.replaceState(null, "", "#" + id);
        }
      }

      links.forEach((link) => {
        link.addEventListener("click", () => {
          scrollSection(link.dataset.section);
        });
      });

      document
        .querySelectorAll(".tool-button[data-section-target]")
        .forEach((button) => {
          button.addEventListener("click", () => {
            const targetSection = button.dataset.sectionTarget;
            if (targetSection) {
              scrollSection(targetSection);
            }
          });
        });

      // Resume download handler
      const resumeBtn = document.getElementById("resume-btn");
      if (resumeBtn) {
        resumeBtn.addEventListener("click", () => {
          const link = document.createElement("a");
          link.href = "../../my-documents/Resume.pdf";
          link.download = "Gabriel_Santos_Resume.pdf";
          document.body.appendChild(link);
          link.click();
          document.body.removeChild(link);
        });
      }

      // Refresh button handler
      const refreshBtn = document.getElementById("refresh-btn");
      if (refreshBtn) {
        refreshBtn.addEventListener("click", () => {
          location.reload();
        });
      }

      // Home button handler - scroll to top
      const homeBtn = document.getElementById("home-btn");
      if (homeBtn) {
        homeBtn.addEventListener("click", () => {
          const scrollElement = getScrollElement();
          scrollElementTo(scrollElement, 0, "smooth");
          setActiveLink(defaultSection);
        });
      }

      // Blog button handler
      const blogBtn = document.getElementById("blog-btn");
      if (blogBtn) {
        blogBtn.addEventListener("click", () => {
          window.open("https://wordpress.org", "_blank");
        });
      }

      // Framework download handler
      const frameworkBtn = document.getElementById("framework-btn");
      if (frameworkBtn) {
        frameworkBtn.addEventListener("click", async (e) => {
          e.preventDefault();
          const filePath = "../../my-documents/framework_report.pdf";
          const fileName = "framework_report.pdf";
          try {
            const res = await fetch(filePath);
            if (!res.ok) throw new Error(`HTTP ${res.status}`);
            const blob = await res.blob();
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            a.download = fileName;
            document.body.appendChild(a);
            a.click();
            a.remove();
            URL.revokeObjectURL(url);
          } catch (err) {
            console.error("Framework download failed", err);
            alert("Could not download framework_report.pdf");
          }
        });
      }

      const observerScrollEl = getScrollElement();
      const observerRoot =
        observerScrollEl &&
        observerScrollEl !== document.body &&
        observerScrollEl !== document.documentElement
          ? observerScrollEl
          : null;
      const observer = new IntersectionObserver(
        (entries) => {
          const atTop = getScrollTop(getScrollElement()) === 0;
          entries.forEach((entry) => {
            if (entry.isIntersecting) {
              if (atTop && entry.target.id !== defaultSection) {
                return;
              }
              setActiveLink(entry.target.id);
            }
          });
        },
        { root: observerRoot, threshold: 0.35 }
      );

      sections.forEach((section) => observer.observe(section));

      const initialHash = decodeURIComponent(location.hash.replace("#", ""));
      const normalizedHash =
        initialHash && initialHash !== defaultSection ? initialHash : "";
      const ensureTop = () => {
        const scrollElement = getScrollElement();
        scrollElementTo(scrollElement, 0, "auto");
        if (scrollElement !== mainArea) {
          mainArea?.scrollTo({ top: 0, behavior: "auto" });
        }
      };

      const handleInitialPosition = () => {
        if (normalizedHash) {
          scrollSection(normalizedHash, {
            behavior: "auto",
            updateHistory: false,
          });
        } else {
          ensureTop();
          setActiveLink(defaultSection);
        }
      };

      ensureTop();
      if (document.readyState === "complete") {
        requestAnimationFrame(handleInitialPosition);
      } else {
        window.addEventListener("load", () =>
          requestAnimationFrame(handleInitialPosition)
        );
      }
    </script>
  </body>
</html>
